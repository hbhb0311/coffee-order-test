# 커피 주문 앱

## 1. 프로젝트 개요

### 1.1 프로젝트명
커피 주문 앱

### 1.2 프로젝트 목적
사용자가 커피 메뉴를 주문하고, 관리자가 주문을 관리할 수 있는 간단한 풀스택 웹 앱

### 1.3 개발 범위
- 주문하기 화면(메뉴 선택 및 장바구니 기능)
- 관리자 화면(재고 관리 및 주문 상태 관리)
- 데이터를 생성/조회/수정/삭제할 수 있는 기능

## 2. 기술 스택
- 프론트엔드: HTML, CSS, React, JavaScript, Vite
- 백엔드: Node.js, Express
- 데이터베이스: PostgreSQL

## 3. 기본 사항
- 프론트엔드와 백엔드를 따로 개발
- 기본적인 웹 기술만 사용
- 학습 목적이므로 사용자 인증이나 결제 기능 제외
- 메뉴는 커피 메뉴만 있음

## 4. 화면별 상세 요구사항

### 4.1 주문하기 화면 상세 사양

#### 4.1.1 화면 구조
주문하기 화면은 다음과 같은 구조로 구성됩니다:
- **헤더 영역**: 상단 고정
- **메뉴 아이템 영역**: 메인 콘텐츠 영역
- **장바구니 영역**: 하단 고정

#### 4.1.2 헤더 영역

##### 4.1.2.1 구성 요소
- **로고**: 좌측 상단에 "COFFEELUV" 텍스트가 포함된 연보라색 배경의 박스
- **주문하기 버튼**: 로고 우측에 위치 (현재 화면이므로 활성화 상태)
- **관리자 버튼**: 주문하기 버튼 우측에 위치 (관리자 화면으로 이동)

##### 4.1.2.2 기능 요구사항
- 관리자 버튼 클릭 시 관리자 화면으로 이동
- 주문하기 버튼은 현재 화면 표시용 (클릭 시 동작 없음)

#### 4.1.3 메뉴 아이템 영역

##### 4.1.3.1 메뉴 카드 구조
각 메뉴 아이템은 카드 형태로 표시되며, 다음 정보를 포함합니다:

1. **메뉴 이미지**
   - 카드 상단에 위치
   - 이미지가 없는 경우 플레이스홀더 표시 (대각선이 그어진 흰색 박스)

2. **메뉴 이름**
   - 이미지 하단에 위치
   - 예: "아메리카노(ICE)", "아메리카노(HOT)", "카페라떼"

3. **가격**
   - 메뉴 이름 하단에 위치
   - 한국 원화 형식으로 표시 (예: "4,000원", "5,000원")

4. **설명**
   - 가격 하단에 위치
   - 기본 텍스트: "간단한 설명..."

5. **옵션 선택**
   - 설명 하단에 체크박스 형태로 표시
   - 각 옵션은 옵션명과 추가 가격을 함께 표시
   - 예시 옵션:
     - "샷 추가 (+500원)"
     - "시럽 추가 (+0원)"
   - 여러 옵션을 동시에 선택 가능

6. **주문하기 버튼**
   - 카드 하단에 위치 (담기 버튼 왼쪽)
   - 연한 보라색 배경의 버튼 (#a68fb8)
   - 버튼 텍스트: "주문하기"
   - 클릭 시 선택된 옵션과 함께 바로 주문 처리

7. **담기 버튼**
   - 카드 하단에 위치 (주문하기 버튼 오른쪽)
   - 연보라색 배경의 버튼 (#c8a2c8)
   - 버튼 텍스트: "담기"

##### 4.1.3.2 레이아웃
- 메뉴 카드들은 가로로 나열되어 표시
- 반응형 디자인 고려 (화면 크기에 따라 카드 개수 조정)

##### 4.1.3.3 기능 요구사항
- 옵션 선택: 체크박스를 통해 옵션 선택/해제 가능
- 담기 버튼 클릭 시:
  - 선택된 옵션과 함께 메뉴 아이템이 장바구니에 추가됨
  - 동일한 메뉴+옵션 조합이 이미 장바구니에 있으면 수량 증가
  - 장바구니에 추가 후 장바구니 영역이 업데이트됨
  - 모든 메뉴 카드의 옵션이 자동으로 초기화됨
  - "장바구니에 담겼습니다." 알림 표시
- 주문하기 버튼 클릭 시:
  - 선택된 옵션과 함께 해당 메뉴를 바로 주문 처리
  - 재고가 부족한 경우 "재고가 없습니다." Toast 알림 표시
  - 주문이 완료되면 "주문이 완료되었습니다!" Toast 알림 표시
  - 모든 메뉴 카드의 옵션이 자동으로 초기화됨
- 이미지 로딩 실패 시 자동으로 플레이스홀더 표시

#### 4.1.4 장바구니 영역

##### 4.1.4.1 구성 요소
장바구니는 화면 하단에 고정되어 표시되며, 기본적으로 대부분 숨겨져 있고 상단 중앙의 화살표 트리거를 통해 표시됩니다:

1. **장바구니 트리거**
   - 화면 하단 중앙에 위치한 작은 화살표 모양의 트리거
   - 마우스를 올리면 장바구니가 위로 올라와 표시됨
   - 기본 상태에서는 총 금액만 보이도록 일부만 노출

2. **장바구니 제목**
   - "장바구니" 텍스트 표시

3. **전체 삭제 버튼**
   - 장바구니 아이템 목록 상단에 위치
   - 연보라색 배경의 버튼
   - 버튼 텍스트: "전체 삭제"
   - 클릭 시 장바구니의 모든 아이템 삭제

4. **장바구니 아이템 목록**
   - 각 아이템은 다음 정보를 포함:
     - 메뉴 이름
     - 선택된 옵션 (있는 경우): "(옵션명)" 형식으로 표시
     - 수량 조절 버튼: "+", "-" 버튼과 수량 표시
     - 개별 삭제 버튼: "×" 버튼으로 해당 아이템만 삭제
     - 가격: 해당 아이템의 총 가격 (기본 가격 + 옵션 가격) × 수량
   - 예시: "아메리카노(ICE) (샷 추가)" - 수량 조절 - "4,500원"
   - 예시: "아메리카노(HOT)" - 수량 조절 - "8,000원"
   - 아이템이 많을 경우 스크롤 가능

5. **총 금액**
   - 장바구니 아이템 목록 우측에 위치
   - "총 금액" 레이블과 함께 표시
   - 금액은 굵은 글씨로 강조
   - 모든 장바구니 아이템의 가격 합계를 표시
   - 장바구니가 접혀있어도 항상 표시됨
   - 예시: "총 금액" - "12,500원"

6. **주문하기 버튼**
   - 총 금액 하단에 위치
   - 연보라색 배경의 버튼 (#c8a2c8)
   - 버튼 텍스트: "주문하기"
   - 장바구니가 비어있으면 비활성화

##### 4.1.4.2 기능 요구사항
- 장바구니는 기본적으로 하단에 숨겨져 있으며, 상단 중앙의 화살표 트리거에 마우스를 올리면 표시됨
- 장바구니 아이템 추가/수정 시 실시간으로 총 금액 업데이트
- 수량 조절:
  - "+" 버튼 클릭 시 해당 아이템 수량 증가
  - "-" 버튼 클릭 시 해당 아이템 수량 감소 (0이 되면 자동 삭제)
- 개별 아이템 삭제:
  - 각 아이템 옆의 "×" 버튼으로 해당 아이템만 삭제
- 전체 삭제:
  - "전체 삭제" 버튼으로 장바구니의 모든 아이템 한 번에 삭제
- 주문하기 버튼 클릭 시:
  - 장바구니가 비어있는 경우 "장바구니가 비어있습니다." Toast 알림 표시
  - 장바구니에 아이템이 있는 경우 재고 검증 후 주문 처리
  - 재고가 부족한 경우 "재고가 없습니다." Toast 알림 표시
  - 재고가 충분한 경우 주문 처리 및 "주문이 완료되었습니다!" Toast 알림 표시
  - 주문 완료 후 장바구니 초기화
- 아이템이 많을 경우 장바구니 영역 내부에서 스크롤 가능

#### 4.1.5 UI/UX 요구사항

##### 4.1.5.1 디자인
- 전체적으로 깔끔하고 미니멀한 디자인
- 흰색 배경에 다크 그레이 텍스트 사용
- COFFEELUV 로고는 연보라색 배경에 흰색 텍스트 (#c8a2c8)
- 네비게이션 영역은 연보라색 배경 (#c8a2c8)
- 버튼은 연보라색 배경 사용 (#c8a2c8)
- 주문하기 버튼은 연한 보라색 배경 사용 (#a68fb8)으로 담기 버튼과 구분
- 모든 border는 2px 두께로 설정

##### 4.1.5.2 사용자 경험
- 메뉴 카드와 장바구니는 명확하게 구분되어 표시
- 가격 정보는 명확하게 표시되어야 함
- 옵션 선택 시 추가 가격이 명확히 표시되어야 함
- 장바구니에 아이템이 추가되면 Toast 알림으로 확인 가능
- Toast 알림은 화면 우측 상단에 표시되며 자동으로 사라짐
- 키보드 네비게이션 지원 (Enter, Space 키로 버튼 클릭 가능)
- 스크린 리더 지원을 위한 ARIA 레이블 제공

##### 4.1.5.3 상태 관리
- 장바구니 상태는 실시간으로 업데이트되어야 함
- 동일한 메뉴+옵션 조합은 수량으로 관리
- 총 금액은 항상 정확하게 계산되어야 함
- 메뉴 카드의 옵션은 아이템 추가 후 자동으로 초기화됨

### 4.2 관리자 화면 상세 사양

#### 4.2.1 화면 구조
관리자 화면은 다음과 같은 구조로 구성됩니다:
- **헤더 영역**: 상단 고정
- **관리자 대시보드 영역**: 주문 현황 요약
- **재고 현황 영역**: 메뉴별 재고 관리
- **주문 현황 영역**: 주문 목록 및 상태 관리

#### 4.2.2 헤더 영역

##### 4.2.2.1 구성 요소
- **로고**: 좌측 상단에 "COFFEELUV" 텍스트가 포함된 연보라색 배경의 박스
- **주문하기 버튼**: 로고 우측에 위치 (주문하기 화면으로 이동)
- **관리자 버튼**: 주문하기 버튼 우측에 위치 (현재 화면이므로 활성화 상태)

##### 4.2.2.2 기능 요구사항
- 주문하기 버튼 클릭 시 주문하기 화면으로 이동
- 관리자 버튼은 현재 화면 표시용 (클릭 시 동작 없음)

#### 4.2.3 관리자 대시보드 영역

##### 4.2.3.1 구성 요소
관리자 대시보드는 직사각형 박스 형태로 표시되며, 다음 정보를 포함합니다:

1. **섹션 제목**
   - "관리자 대시보드" 텍스트 표시

2. **주문 현황 요약**
   - 다음 통계 정보를 표시:
     - "총 주문 N": 전체 주문 건수
     - "주문 접수 N": 주문 접수 상태인 주문 건수
     - "제조 중 N": 제조 중 상태인 주문 건수
     - "제조 완료 N": 제조 완료 상태인 주문 건수

##### 4.2.3.2 기능 요구사항
- 주문 상태가 변경될 때마다 실시간으로 통계 정보 업데이트
- 각 통계는 해당 상태의 주문 건수를 정확하게 표시
- 각 통계 박스는 클릭 가능하며, 클릭 시 주문 현황 영역이 해당 상태로 필터링됨
  - "총 주문" 클릭: 모든 주문 표시
  - "주문 접수" 클릭: 주문 접수 상태인 주문만 표시
  - "제조 중" 클릭: 제조 중 상태인 주문만 표시
  - "제조 완료" 클릭: 제조 완료 상태인 주문만 표시
- 같은 박스를 다시 클릭하면 필터 해제 (모든 주문 표시)
- 활성화된 필터 박스는 시각적으로 구분됨 (배경색 변경)

#### 4.2.4 재고 현황 영역

##### 4.2.4.1 구성 요소
재고 현황은 직사각형 박스 형태로 표시되며, 다음 요소를 포함합니다:

1. **섹션 제목**
   - "재고 현황" 텍스트 표시

2. **재고 카드**
   - 각 메뉴 아이템별로 개별 카드로 표시 (총 6개 메뉴 모두 표시)
   - 각 카드는 다음 정보를 포함:
     - **메뉴 이름**: 예: "아메리카노 (ICE)", "아메리카노 (HOT)", "카페라떼", "카푸치노", "에스프레소", "카라멜 마키아토"
     - **재고 상태 배지**: 재고 수량에 따라 상태 표시
       - "정상": 재고 5개 이상 (초록색 배지)
       - "주의": 재고 1~4개 (주황색 배지)
       - "품절": 재고 0개 (빨간색 배지)
     - **재고 수량**: "N개" 형식으로 표시 (예: "10개")
     - **수량 조절 버튼**: 
       - "+" 버튼: 재고 수량 증가 (최대 999개)
       - "-" 버튼: 재고 수량 감소

##### 4.2.4.2 레이아웃
- 재고 카드들은 한 줄에 2개씩 표시 (Grid 레이아웃)
- 각 카드는 동일한 크기와 스타일로 통일
- 카드 그룹 전체가 가운데 정렬됨
- 재고 현황 영역과 주문 현황 영역의 높이가 동일하게 고정됨 (600px)
- 재고 카드가 많을 경우 내부에서 스크롤 가능

##### 4.2.4.3 기능 요구사항
- "+" 버튼 클릭 시:
  - 해당 메뉴의 재고 수량이 1 증가
  - 최대값 999개로 제한
  - 변경된 재고 수량이 즉시 화면에 반영
  - 재고 상태 배지가 자동으로 업데이트됨
- "-" 버튼 클릭 시:
  - 해당 메뉴의 재고 수량이 1 감소
  - 재고 수량이 0 미만으로 내려가지 않도록 제한 (최소값 0)
  - 변경된 재고 수량이 즉시 화면에 반영
  - 재고 상태 배지가 자동으로 업데이트됨
- 재고 수량 변경 시 데이터베이스에 즉시 반영

#### 4.2.5 주문 현황 영역

##### 4.2.5.1 구성 요소
주문 현황은 직사각형 박스 형태로 표시되며, 다음 요소를 포함합니다:

1. **섹션 제목**
   - "주문 현황" 텍스트 표시

2. **주문 목록**
   - 각 주문은 개별 항목으로 표시되며, 다음 정보를 포함:
     - **주문 시간**: "년 월 일 시:분" 형식으로 표시 (예: "2025년 7월 31일 13:00")
     - **주문 내용**: 메뉴 이름과 수량을 표시 (예: "아메리카노(ICE) x 1")
     - **주문 금액**: 한국 원화 형식으로 표시 (예: "4,000원")
     - **상태 변경 버튼**: 현재 주문 상태에 따라 다른 버튼이 표시됨
       - "제조 시작": 주문 접수 상태 (클릭 시 "제조 중"으로 변경)
       - "제조 완료": 제조 중 상태 (클릭 시 "제조 완료"로 변경, 연한 파란색 배경)
       - "제조 완료": 제조 완료 상태 (비활성화, 연한 파란색 배경)

##### 4.2.5.2 레이아웃
- 주문 목록은 시간순으로 정렬되어 표시 (최신 주문이 상단)
- 각 주문 항목은 명확하게 구분되어 표시

##### 4.2.5.3 기능 요구사항
- 주문 목록은 실시간으로 업데이트 (새 주문이 들어오면 즉시 표시)
- 관리자 대시보드의 필터 기능과 연동:
  - "총 주문" 필터: 모든 주문 표시
  - "주문 접수" 필터: "제조 시작" 버튼이 있는 주문만 표시
  - "제조 중" 필터: "제조 완료" 버튼이 있는 주문만 표시
  - "제조 완료" 필터: 비활성화된 "제조 완료" 버튼이 있는 주문만 표시
- 상태 변경 버튼 클릭 시:
  - "제조 시작" → "제조 중"으로 상태 변경
  - "제조 완료" → "제조 완료"로 상태 변경 (비활성화)
  - "제조 완료" 상태에서는 더 이상 상태 변경 불가
- 상태 변경 시 관리자 대시보드의 통계 정보도 함께 업데이트
- 주문에 옵션이 포함된 경우 주문 내용에 옵션 정보도 표시 (예: "아메리카노(ICE) (샷 추가) x 1")
- 주문 현황 영역과 재고 현황 영역의 높이가 동일하게 고정됨 (600px)
- 주문이 많을 경우 내부에서 스크롤 가능

#### 4.2.6 UI/UX 요구사항

##### 4.2.6.1 디자인
- 주문하기 화면과 동일한 디자인 스타일 유지
- 전체적으로 깔끔하고 미니멀한 디자인
- 흰색 배경에 다크 그레이 텍스트 사용
- COFFEELUV 로고는 연보라색 배경에 흰색 텍스트 (#c8a2c8)
- 네비게이션 영역은 연보라색 배경 (#c8a2c8)
- 버튼은 연보라색 배경 사용 (#c8a2c8)
- 관리자 대시보드 통계 박스는 밝은 연보라색 배경 (#f0e6f5)
- 통계 박스의 숫자는 진한 보라색 (#8b6fa8)
- 통계 박스는 3D 효과가 적용됨 (box-shadow)
- 제조 완료 버튼은 연한 파란색 배경 (#7fb3d3)
- 모든 border는 2px 두께로 설정

##### 4.2.6.2 사용자 경험
- 각 영역(대시보드, 재고, 주문)이 명확하게 구분되어 표시
- 재고 수량과 주문 상태를 한눈에 파악할 수 있어야 함
- 버튼 클릭 시 즉각적인 피드백 제공 (시각적 변화)
- 주문 현황은 최신 주문이 상단에 표시되어 관리자가 쉽게 확인 가능
- 관리자 대시보드 통계 박스 클릭으로 주문 필터링 가능
- 키보드 네비게이션 지원 (Enter, Space 키로 버튼 클릭 가능)
- 스크린 리더 지원을 위한 ARIA 레이블 제공

##### 4.2.6.3 상태 관리
- 재고 수량 변경 시 즉시 데이터베이스에 반영
- 주문 상태 변경 시 즉시 데이터베이스에 반영
- 대시보드 통계는 주문 상태 변경 시 실시간으로 업데이트
- 새 주문이 들어오면 주문 현황 목록에 즉시 추가
- 필터 상태는 관리자 페이지 내에서 유지됨

## 5. 구현 세부사항

### 5.1 코드 구조
- **데이터 분리**: 메뉴 데이터는 `src/data/menuItems.js`에 별도 관리
- **유틸리티 함수**: ID 생성 등 공통 기능은 `src/utils/` 폴더에 분리
- **컴포넌트 구조**: 페이지별로 `pages/` 폴더, 재사용 컴포넌트는 `components/` 폴더에 구성

### 5.2 사용자 알림
- **Toast 알림 시스템**: `alert()` 대신 Toast 컴포넌트 사용
- Toast는 화면 우측 상단에 표시되며 자동으로 사라짐 (기본 3초)
- 사용자가 수동으로 닫을 수 있음

### 5.3 접근성
- 모든 버튼에 `aria-label` 속성 추가
- 키보드 네비게이션 지원 (Enter, Space 키)
- 스크린 리더 지원을 위한 ARIA 속성 적용
- 시맨틱 HTML 태그 사용 (header, nav, main 등)

### 5.4 성능 최적화
- 관리자 대시보드 통계 계산은 `useMemo`로 메모이제이션
- 불필요한 리렌더링 방지

### 5.5 에러 처리
- 이미지 로딩 실패 시 자동으로 플레이스홀더 표시
- 입력 검증: 재고 수량 최대값 제한 (999개), 최소값 제한 (0개)

### 5.6 ID 생성
- 안전한 ID 생성 유틸리티 사용 (타임스탬프 + 카운터 + 랜덤 문자열)
- 동시성 문제 방지

## 6. 백엔드 개발 요구사항

### 6.1 데이터 모델

#### 6.1.1 Product (상품)
상품 정보를 저장하는 테이블입니다.

**필드:**
- `prd_id` (INTEGER, PRIMARY KEY): 상품 고유 ID
- `prd_nm` (VARCHAR): 상품 이름 (예: "아메리카노(ICE)", "카페라떼")
- `prd_desc` (TEXT): 상품 설명
- `prd_prc` (INTEGER): 기본 가격 (원 단위)
- `prd_img` (VARCHAR): 이미지 URL 또는 경로
- `prd_stk` (INTEGER): 재고 수량 (기본값: 10, 최대값: 999)
- `crt_dt` (TIMESTAMP): 생성 일시
- `updt_dt` (TIMESTAMP): 수정 일시

**제약 조건:**
- `prd_prc`는 0 이상의 정수
- `prd_stk`은 0 이상 999 이하의 정수

#### 6.1.2 Option (옵션)
상품에 추가할 수 있는 옵션 정보를 저장하는 테이블입니다. 하나의 옵션은 여러 상품에 적용될 수 있습니다.

**필드:**
- `opt_id` (INTEGER, PRIMARY KEY): 옵션 고유 ID
- `opt_nm` (VARCHAR): 옵션 이름 (예: "샷 추가", "시럽 추가", "휘핑 크림")
- `opt_prc` (INTEGER): 옵션 추가 가격 (원 단위, 0 이상)
- `crt_dt` (TIMESTAMP): 생성 일시
- `updt_dt` (TIMESTAMP): 수정 일시

**제약 조건:**
- `opt_prc`는 0 이상의 정수

**예시 옵션:**
- 샷 추가 (+500원): 에스프레소 샷 추가
- 시럽 추가 (+0원): 바닐라, 헤이즐넛 등 시럽 추가
- 휘핑 크림 (+500원): 휘핑 크림 추가
- 사이즈 업 (+1000원): 사이즈 업그레이드

#### 6.1.3 ProductOption (상품-옵션 관계)
Product와 Option 사이의 다대다(N:M) 관계를 관리하는 중간 테이블입니다. 하나의 상품에 여러 옵션을 연결할 수 있고, 하나의 옵션이 여러 상품에 적용될 수 있습니다.

**필드:**
- `prd_opt_id` (INTEGER, PRIMARY KEY): 관계 고유 ID
- `prd_id` (INTEGER, FOREIGN KEY): 상품 ID (Product 테이블 참조)
- `opt_id` (INTEGER, FOREIGN KEY): 옵션 ID (Option 테이블 참조)
- `del_yn` (VARCHAR): 삭제 여부
- `crt_dt` (TIMESTAMP): 생성 일시
- `updt_dt` (TIMESTAMP): 수정 일시

**제약 조건:**
- `prd_id`는 Product 테이블의 유효한 ID를 참조해야 함
- `opt_id`는 Option 테이블의 유효한 ID를 참조해야 함
- `(prd_id, opt_id)` 조합은 UNIQUE (동일한 상품-옵션 관계 중복 방지)

**사용 예시:**
- 아메리카노(ICE)에 "샷 추가", "시럽 추가" 옵션 연결
- 카페라떼에 "샷 추가", "시럽 추가", "휘핑 크림" 옵션 연결
- 카라멜 마키아토에 "샷 추가", "시럽 추가", "휘핑 크림", "사이즈 업" 옵션 연결

#### 6.1.4 Order (주문)
주문 정보를 저장하는 테이블입니다. 최종 주문 상태만 관리하며, 상태 변경 이력은 OrderStatusHistory 테이블에서 별도로 관리합니다.

**필드:**
- `ord_id` (INTEGER, PRIMARY KEY): 주문 고유 ID
- `ord_dt` (TIMESTAMP): 주문 일시
- `ord_sts` (VARCHAR): 최종 주문 상태 (현재 상태)
  - "received": 주문 접수
  - "in_progress": 제조 중
  - "completed": 제조 완료
- `tot_amt` (INTEGER): 총 주문 금액 (원 단위)
- `crt_dt` (TIMESTAMP): 생성 일시
- `updt_dt` (TIMESTAMP): 수정 일시

**제약 조건:**
- `ord_sts`는 "received", "in_progress", "completed" 중 하나여야 함
- `tot_amt`는 0 이상의 정수

**설명:**
- 주문 생성 시 `ord_sts`는 "received"로 초기화됨
- 주문 상태가 변경될 때마다 `ord_sts`가 업데이트되고, 동시에 OrderStatusHistory 테이블에 이력이 기록됨
- 최종 상태만 조회하면 되므로 빠른 조회가 가능함

#### 6.1.5 OrderStatusHistory (주문 상태 변경 이력)
주문 상태 변경 이력을 저장하는 테이블입니다. 주문이 생성될 때부터 완료될 때까지의 모든 상태 변경 내역을 추적합니다.

**필드:**
- `ord_sts_hist_id` (INTEGER, PRIMARY KEY): 주문 상태 이력 고유 ID
- `ord_id` (INTEGER, FOREIGN KEY): 주문 ID (Order 테이블 참조)
- `ord_sts` (VARCHAR): 변경된 주문 상태
  - "received": 주문 접수
  - "in_progress": 제조 중
  - "completed": 제조 완료
- `crt_dt` (TIMESTAMP): 생성 일시
- `updt_dt` (TIMESTAMP): 수정 일시

**제약 조건:**
- `ord_id`는 Order 테이블의 유효한 ID를 참조해야 함
- `ord_sts`는 "received", "in_progress", "completed" 중 하나여야 함

**사용 예시:**
- 주문 생성 시: ord_id=1, ord_sts="received", crt_dt=2025-01-15 10:00:00
- 제조 시작 시: ord_id=1, ord_sts="in_progress", crt_dt=2025-01-15 10:05:00
- 제조 완료 시: ord_id=1, ord_sts="completed", crt_dt=2025-01-15 10:10:00

**설명:**
- 주문이 생성될 때 첫 번째 이력 레코드가 자동으로 생성됨 (상태: "received")
- 주문 상태가 변경될 때마다 새로운 이력 레코드가 추가됨
- 주문별 상태 변경 히스토리를 시간순으로 조회 가능
- 각 상태 변경 시점을 정확히 추적할 수 있음

#### 6.1.6 OrderProduct (주문 상품)
주문에 포함된 개별 상품 정보를 저장하는 테이블입니다. 하나의 주문 상품에 여러 옵션이 선택될 수 있습니다.

**필드:**
- `ord_prd_id` (INTEGER, PRIMARY KEY): 주문 항목 고유 ID
- `ord_id` (INTEGER, FOREIGN KEY): 주문 ID (Order 테이블 참조)
- `prd_id` (INTEGER, FOREIGN KEY): 상품 ID (Product 테이블 참조)
- `prd_cnt` (INTEGER): 주문 수량
- `unit_amt` (INTEGER): 단가 (메뉴 가격 + 선택된 모든 옵션 가격의 합)
- `subtot_amt` (INTEGER): 소계 (단가 × 수량)
- `crt_dt` (TIMESTAMP): 생성 일시

**제약 조건:**
- `prd_cnt`는 1 이상의 정수
- `unit_amt`와 `subtot_amt`은 0 이상의 정수

**단가 계산 예시:**
- 아메리카노(ICE) 4,000원 + 샷 추가 500원 + 시럽 추가 0원 = 4,500원

#### 6.1.7 OrderProductOption (주문 상품 옵션)
주문 상품에 선택된 옵션 정보를 저장하는 테이블입니다. 하나의 주문 상품에 여러 옵션이 동시에 선택될 수 있으므로, 선택된 각 옵션에 대해 별도의 레코드가 생성됩니다.

**필드:**
- `ord_opt_id` (INTEGER, PRIMARY KEY): 주문 상품 옵션 고유 ID
- `ord_prd_id` (INTEGER, FOREIGN KEY): 주문 상품 ID (OrderProduct 테이블 참조)
- `opt_id` (INTEGER, FOREIGN KEY): 옵션 ID (Option 테이블 참조)
- `opt_prc` (INTEGER): 옵션 가격 (주문 시점의 가격 기록)
- `crt_dt` (TIMESTAMP): 생성 일시

**제약 조건:**
- `ord_prd_id`와 `opt_id`는 각각 유효한 ID를 참조해야 함
- `opt_prc`는 0 이상의 정수

**사용 예시:**
- 주문 항목 1 (아메리카노 ICE)에 "샷 추가"와 "시럽 추가" 2개의 옵션이 선택된 경우:
  - OrderProductOption 레코드 1: ord_prd_id=1, opt_id=1 (샷 추가), opt_prc=500
  - OrderProductOption 레코드 2: ord_prd_id=1, opt_id=2 (시럽 추가), opt_prc=0

### 6.2 데이터 스키마를 위한 사용자 흐름

#### 6.2.1 메뉴 조회 및 표시
1. **프론트엔드 요청**: 주문하기 화면 진입 시 메뉴 목록 조회 요청
2. **백엔드 처리**: 
   - Product 테이블에서 모든 메뉴 정보 조회
   - ProductOption 테이블을 통해 각 메뉴에 연결된 Option 정보 조회 (다대다 관계)
   - 재고 수량(stock) 정보 포함
3. **프론트엔드 표시**:
   - 주문하기 화면: 메뉴 이름, 설명, 가격, 이미지, 해당 메뉴에 적용 가능한 옵션 정보 표시
   - 관리자 화면: 재고 수량(stock) 정보 표시

#### 6.2.2 장바구니 관리
1. **프론트엔드**: 사용자가 메뉴 선택 및 옵션 선택
2. **로컬 상태 관리**: 선택된 메뉴와 옵션을 프론트엔드 상태로 관리
3. **장바구니 표시**: 선택된 메뉴, 옵션, 수량, 가격을 화면에 표시

#### 6.2.3 주문 생성
1. **주문하기 버튼 클릭**:
   - 메뉴 카드의 "주문하기" 버튼 또는 장바구니의 "주문하기" 버튼 클릭
2. **주문 정보 전송**:
   - 주문 일시: 현재 시간
   - 주문 내용: 상품 ID, 수량, 선택된 옵션 ID 목록, 각 항목의 금액
   - 총 금액: 모든 주문 항목의 소계 합계
3. **백엔드 처리**:
   - **재고 검증**: 주문하려는 각 상품의 재고 수량 확인
     - 주문 수량이 재고 수량보다 많으면 주문 실패 처리
     - 재고 부족 시 "재고가 없습니다." 에러 메시지 반환
   - 재고가 충분한 경우에만 다음 단계 진행:
     - Order 테이블에 주문 정보 저장 (상태: "received")
     - OrderStatusHistory 테이블에 초기 상태 이력 저장 (상태: "received", 생성 일시: 주문 생성 일시)
     - OrderProduct 테이블에 각 주문 상품 저장
     - OrderProductOption 테이블에 선택된 옵션 정보 저장
     - 주문된 상품의 재고 수량 감소 (Product 테이블의 prd_stk 업데이트)
4. **응답**: 
   - 성공 시: 생성된 주문 ID 반환
   - 실패 시: 재고 부족 에러 메시지 반환

#### 6.2.4 주문 현황 조회 및 상태 변경
1. **주문 목록 조회**:
   - 관리자 화면 진입 시 또는 주문 현황 영역 표시 시
   - Order 테이블에서 모든 주문 조회 (최신순 정렬)
   - 각 주문의 OrderProduct와 OrderProductOption 정보도 함께 조회
   - Order 테이블의 `ord_sts` 필드로 현재 상태 확인
2. **주문 상태 변경**:
   - "주문 접수" → "제조 중": 
     - Order 테이블의 `ord_sts`를 "in_progress"로 업데이트
     - OrderStatusHistory 테이블에 새로운 이력 레코드 추가 (상태: "in_progress", 생성 일시: 현재 시간)
   - "제조 중" → "제조 완료":
     - Order 테이블의 `ord_sts`를 "completed"로 업데이트
     - OrderStatusHistory 테이블에 새로운 이력 레코드 추가 (상태: "completed", 생성 일시: 현재 시간)
   - "제조 완료" 상태에서는 더 이상 변경 불가
3. **주문 상태 이력 조회**:
   - 특정 주문의 상태 변경 이력을 조회하려면 OrderStatusHistory 테이블에서 `ord_id`로 필터링하여 시간순으로 조회
   - 각 상태 변경 시점을 정확히 추적 가능
4. **실시간 업데이트**: 상태 변경 시 관리자 대시보드 통계 정보도 함께 업데이트

### 6.3 API 설계

#### 6.3.1 메뉴 목록 조회 API

**엔드포인트:** `GET /api/menus`

**설명:** 주문하기 화면 진입 시 DB에서 메뉴 목록을 불러와 보여줍니다.

**요청:**
- Method: GET
- Headers: 없음
- Body: 없음

**응답:**
```json
{
  "success": true,
  "data": [
    {
      "prd_id": 1,
      "prd_nm": "아메리카노(ICE)",
      "prd_desc": "간단한 설명...",
      "prd_prc": 4000,
      "prd_img": "https://example.com/image.jpg",
      "prd_stk": 10,
      "options": [
        {
          "opt_id": 1,
          "opt_nm": "샷 추가",
          "opt_prc": 500
        },
        {
          "opt_id": 2,
          "opt_nm": "시럽 추가",
          "opt_prc": 0
        }
      ]
    },
    ...
  ]
}
```

**에러 응답:**
```json
{
  "success": false,
  "error": "메뉴 목록을 불러오는데 실패했습니다."
}
```

#### 6.3.2 주문 생성 API

**엔드포인트:** `POST /api/orders`

**설명:** 사용자가 메뉴를 선택하고 '주문하기' 버튼을 누르면 주문 정보를 DB에 저장합니다.

**요청:**
- Method: POST
- Headers: `Content-Type: application/json`
- Body:
```json
{
  "items": [
    {
      "prdId": 1,
      "prd_cnt": 2,
      "optionIds": [1, 2],
      "unitPrice": 4500,
      "subtotal": 9000
    },
    {
      "prdId": 2,
      "prd_cnt": 1,
      "optionIds": [],
      "unitPrice": 5000,
      "subtotal": 5000
    }
  ],
  "totalAmount": 14000
}
```

**응답:**
```json
{
  "success": true,
  "data": {
    "orderId": 123,
    "orderDate": "2025-01-15T10:30:00Z",
    "status": "received",
    "totalAmount": 14000
  }
}
```

**에러 응답:**
```json
{
  "success": false,
  "error": "재고가 없습니다.",
  "code": "INSUFFICIENT_STOCK",
  "data": {
    "productId": 1,
    "productName": "아메리카노(ICE)",
    "requestedQuantity": 2,
    "availableStock": 1
  }
}
```

또는

```json
{
  "success": false,
  "error": "주문 처리 중 오류가 발생했습니다.",
  "code": "ORDER_PROCESSING_ERROR"
}
```

**비즈니스 로직:**
1. **재고 검증 단계**:
   - 주문하려는 각 상품에 대해 재고 수량 확인
   - 주문 수량(`prd_cnt`)이 현재 재고 수량(`prd_stk`)보다 많으면 주문 실패
   - 재고 부족 상품이 있으면 해당 상품 정보와 함께 에러 반환
2. **주문 처리 단계** (재고 검증 통과 시):
   - 트랜잭션 시작
   - Order 테이블에 주문 정보 저장 (상태: "received")
   - OrderStatusHistory 테이블에 초기 상태 이력 저장
   - OrderProduct 테이블에 각 주문 상품 저장
   - OrderProductOption 테이블에 선택된 옵션 정보 저장
   - 각 상품의 재고 수량을 주문 수량만큼 감소 (Product 테이블의 prd_stk 업데이트)
   - 트랜잭션 커밋
3. **트랜잭션 처리**:
   - 주문 생성과 재고 감소를 원자적으로 처리
   - 중간에 오류 발생 시 전체 롤백

#### 6.3.3 주문 정보 조회 API

**엔드포인트:** `GET /api/orders/:orderId`

**설명:** 주문 ID를 전달하면 해당 주문 정보를 노출합니다.

**요청:**
- Method: GET
- Headers: 없음
- Path Parameters:
  - `orderId`: 주문 ID (INTEGER)

**응답:**
```json
{
  "success": true,
  "data": {
    "orderId": 123,
    "orderDate": "2025-01-15T10:30:00Z",
    "status": "received",
    "totalAmount": 14000,
    "items": [
      {
        "prdOptId": 1,
        "prdId": 1,
        "prdName": "아메리카노(ICE)",
        "quantity": 2,
        "unitPrice": 4500,
        "subtotal": 9000,
        "options": [
          {
            "opt_id": 1,
            "opt_nm": "샷 추가",
            "opt_prc": 500
          },
          {
            "opt_id": 2,
            "opt_nm": "시럽 추가",
            "opt_prc": 0
          }
        ]
      },
      ...
    ]
  }
}
```

**에러 응답:**
```json
{
  "success": false,
  "error": "주문을 찾을 수 없습니다."
}
```

#### 6.3.4 주문 목록 조회 API

**엔드포인트:** `GET /api/orders`

**설명:** 관리자 화면의 주문 현황에 표시할 모든 주문 목록을 조회합니다.

**요청:**
- Method: GET
- Headers: 없음
- Query Parameters (선택):
  - `status`: 주문 상태 필터 ("received", "in_progress", "completed")
  - `limit`: 페이지당 항목 수 (기본값: 50)
  - `offset`: 페이지 오프셋 (기본값: 0)

**응답:**
```json
{
  "success": true,
  "data": {
    "orders": [
      {
        "orderId": 123,
        "orderDate": "2025-01-15T10:30:00Z",
        "status": "received",
        "totalAmount": 14000,
        "items": [
          {
            "prdName": "아메리카노(ICE)",
            "prd_cnt": 2,
            "options": ["샷 추가", "시럽 추가"]
          },
          ...
        ]
      },
      ...
    ],
    "total": 100,
    "limit": 50,
    "offset": 0
  }
}
```

#### 6.3.5 주문 상태 변경 API

**엔드포인트:** `PATCH /api/orders/:orderId/status`

**설명:** 주문의 상태를 변경합니다 (주문 접수 → 제조 중 → 제조 완료). Order 테이블의 최종 상태를 업데이트하고, OrderStatusHistory 테이블에 이력을 기록합니다.

**요청:**
- Method: PATCH
- Headers: `Content-Type: application/json`
- Path Parameters:
  - `orderId`: 주문 ID (INTEGER)
- Body:
```json
{
  "status": "in_progress"
}
```

**응답:**
```json
{
  "success": true,
  "data": {
    "orderId": 123,
    "status": "in_progress",
    "updatedAt": "2025-01-15T10:35:00Z",
    "historyId": 456
  }
}
```

**에러 응답:**
```json
{
  "success": false,
  "error": "유효하지 않은 상태 변경입니다."
}
```

**비즈니스 로직:**
- 상태 변경 순서 검증: "received" → "in_progress" → "completed"
- "completed" 상태에서는 더 이상 변경 불가
- 잘못된 상태 변경 시도 시 에러 반환
- 트랜잭션 처리:
  1. Order 테이블의 `ord_sts` 업데이트
  2. Order 테이블의 `updt_dt` 업데이트
  3. OrderStatusHistory 테이블에 새로운 이력 레코드 추가
     - `ord_id`: 주문 ID
     - `ord_sts`: 변경된 상태
     - `chg_dt`: 현재 시간
- 트랜잭션 실패 시 롤백 처리

#### 6.3.6 주문 상태 이력 조회 API

**엔드포인트:** `GET /api/orders/:orderId/history`

**설명:** 특정 주문의 상태 변경 이력을 시간순으로 조회합니다.

**요청:**
- Method: GET
- Headers: 없음
- Path Parameters:
  - `orderId`: 주문 ID (INTEGER)

**응답:**
```json
{
  "success": true,
  "data": {
    "orderId": 123,
    "currentStatus": "completed",
    "history": [
      {
        "id": 1,
        "status": "received",
        "changedAt": "2025-01-15T10:30:00Z"
      },
      {
        "id": 2,
        "status": "in_progress",
        "changedAt": "2025-01-15T10:35:00Z"
      },
      {
        "id": 3,
        "status": "completed",
        "changedAt": "2025-01-15T10:40:00Z"
      }
    ]
  }
}
```

**에러 응답:**
```json
{
  "success": false,
  "error": "주문을 찾을 수 없습니다."
}
```

**비즈니스 로직:**
- OrderStatusHistory 테이블에서 `ord_id`로 필터링
- `chg_dt` 기준 오름차순 정렬 (시간순)
- Order 테이블에서 현재 상태도 함께 조회

#### 6.3.7 재고 수정 API

**엔드포인트:** `PATCH /api/menus/:menuId/stock`

**설명:** 관리자가 메뉴의 재고 수량을 수정합니다.

**요청:**
- Method: PATCH
- Headers: `Content-Type: application/json`
- Path Parameters:
  - `prdId`: 메뉴 ID (INTEGER)
- Body:
```json
{
  "stock": 15
}
```

**응답:**
```json
{
  "success": true,
  "data": {
    "prdId": 1,
    "stock": 15,
    "updatedAt": "2025-01-15T10:40:00Z"
  }
}
```

**에러 응답:**
```json
{
  "success": false,
  "error": "재고 수량은 0 이상 999 이하여야 합니다."
}
```

**비즈니스 로직:**
- 재고 수량은 0 이상 999 이하로 제한
- 유효하지 않은 값 입력 시 에러 반환

#### 6.3.8 주문 통계 조회 API

**엔드포인트:** `GET /api/orders/statistics`

**설명:** 관리자 대시보드에 표시할 주문 통계 정보를 조회합니다.

**요청:**
- Method: GET
- Headers: 없음
- Body: 없음

**응답:**
```json
{
  "success": true,
  "data": {
    "total": 100,
    "received": 25,
    "inProgress": 15,
    "completed": 60
  }
}
```

### 6.4 데이터베이스 스키마 설계

#### 6.4.1 테이블 관계도
```
┌─────────────────────────────────────────────────────────────┐
│                  상품-옵션 관계 (N:M)                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│    Product (N) ──< ProductOption >── (M) Option             │
│      │                              │                       │
│      │                              │                       │
│      └──────────┐    ┌──────────────┘                       │
│                 │    │                                      │
│                 ▼    ▼                                      │
│              ┌──────────────┐                               │
│              │OrderProduct  │                               │
│              └──────┬───────┘                               │
│                     │                                       │
│                     ▼                                       │
│           OrderProductOption                                │
│                                                             │
│    Order (1) ──< (N) OrderStatusHistory                     │
│      │                                                      │
│      │                                                      │
│      └──< (N) OrderProduct                                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘

상세 관계:
- Product (N) ──< ProductOption >── (M) Option  [다대다 관계]
- Product (1) ──< (N) OrderProduct
- Order (1) ──< (N) OrderProduct
- Order (1) ──< (N) OrderStatusHistory  [상태 변경 이력]
- OrderProduct (1) ──< (N) OrderProductOption
- Option (1) ──< (N) OrderProductOption

설명:
- Product와 Option은 ProductOption 테이블을 통해 다대다(N:M) 관계
- 하나의 상품에 여러 옵션을 적용할 수 있음
- 하나의 옵션이 여러 상품에 공통으로 적용될 수 있음
- 주문 시 하나의 OrderProduct에 여러 옵션을 동시에 선택 가능 (OrderProductOption)
- Order 테이블에는 최종 주문 상태만 저장
- OrderStatusHistory 테이블에 주문 상태 변경 이력이 모두 기록됨
- 주문 생성 시 OrderStatusHistory에 초기 상태("received") 이력이 자동 생성됨
- 주문 상태 변경 시마다 OrderStatusHistory에 새로운 이력 레코드가 추가됨
```

#### 6.4.2 인덱스 설계
- `Product.prd_id`: PRIMARY KEY
- `Option.opt_id`: PRIMARY KEY
- `ProductOption.prd_id`: FOREIGN KEY 인덱스
- `ProductOption.opt_id`: FOREIGN KEY 인덱스
- `ProductOption.(prd_id, opt_id)`: UNIQUE 인덱스 (복합 유니크)
- `Order.ord_id`: PRIMARY KEY
- `Order.ord_sts`: 상태별 조회를 위한 인덱스
- `Order.ord_dt`: 시간순 정렬을 위한 인덱스
- `OrderStatusHistory.ord_id`: FOREIGN KEY 인덱스 (주문별 이력 조회)
- `OrderStatusHistory.chg_dt`: 시간순 정렬을 위한 인덱스
- `OrderStatusHistory.(ord_id, chg_dt)`: 복합 인덱스 (주문별 시간순 조회 최적화)
- `OrderProduct.ord_id`: FOREIGN KEY 인덱스
- `OrderProduct.prd_id`: FOREIGN KEY 인덱스
- `OrderProductOption.ord_prd_id`: FOREIGN KEY 인덱스
- `OrderProductOption.opt_id`: FOREIGN KEY 인덱스

#### 6.4.3 제약 조건
- 외래 키 제약 조건: 참조 무결성 보장
- 유니크 제약 조건:
  - `ProductOption.(prd_id, opt_id)`: 동일한 상품-옵션 관계 중복 방지
- 체크 제약 조건: 
  - `Product.prd_stk`: 0 이상 999 이하
  - `Product.prd_prc`: 0 이상
  - `Option.opt_prc`: 0 이상
  - `Order.ord_sts`: "received", "in_progress", "completed" 중 하나
  - `Order.tot_amt`: 0 이상
  - `OrderStatusHistory.ord_sts`: "received", "in_progress", "completed" 중 하나
  - `OrderProduct.prd_cnt`: 1 이상
  - `OrderProduct.unit_amt`: 0 이상
  - `OrderProduct.subtot_amt`: 0 이상
  - `OrderProductOption.opt_prc`: 0 이상

### 6.5 에러 처리

#### 6.5.1 공통 에러 응답 형식
```json
{
  "success": false,
  "error": "에러 메시지",
  "code": "ERROR_CODE"
}
```

#### 6.5.2 주요 에러 코드
- `MENU_NOT_FOUND`: 메뉴를 찾을 수 없음
- `ORDER_NOT_FOUND`: 주문을 찾을 수 없음
- `INSUFFICIENT_STOCK`: 재고 부족
- `INVALID_STATUS`: 유효하지 않은 주문 상태
- `INVALID_STOCK_VALUE`: 유효하지 않은 재고 수량
- `VALIDATION_ERROR`: 입력 데이터 검증 실패
- `DATABASE_ERROR`: 데이터베이스 오류
- `INTERNAL_SERVER_ERROR`: 서버 내부 오류

### 6.6 보안 고려사항

#### 6.6.1 입력 검증
- 모든 입력 데이터에 대한 검증 수행
- SQL Injection 방지를 위한 파라미터화된 쿼리 사용
- XSS 방지를 위한 입력 데이터 이스케이프 처리

#### 6.6.2 트랜잭션 처리
- 주문 생성 시 주문 저장과 재고 감소를 하나의 트랜잭션으로 처리
- 트랜잭션 실패 시 롤백 처리

#### 6.6.3 동시성 제어
- 주문 생성 시 재고 수정에 대한 동시성 제어 (낙관적/비관적 락)
- 주문 상태 변경 시 동시성 제어